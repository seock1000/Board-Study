## 인기글 

- 요구사항
  - 일 단위 10건 선정
    - 점수 = (좋아요 수 * 3) + (댓글 수 * 2) + 조회수
  - 최근 7일 내역 조회
- 특징
  - 대규모 트래픽 : 매일 수백 ~ 수천 건
  - 하루 생성된 모든 게시글에 대해 점수 계산 필요: 1시간 내
- 구현 방법
  1. 배치 처리
     - 오전 12시, 전날 작성 게시물 전체 순회
     - 각 게시글에 대해, 좋아요, 댓글, 조회수 조회
     - 점수 계산 후, 상위 10건 선정
     - 문제점
       - 대규모 데이터이므로 처리 시간이 오래 걸림
         - 병렬처리: 병렬로 처리하기 위한 별도의 구현 필요 
       - 인기글 선정에는 각각의 micro service에 접근 필요
         - Article, Comment, Like, View microservice
         - 인기글 작업으로 인해 타 microservice에 부하 발생 가능성 존재
  2. 스트림 처리
     - 스트림: 연속적인 데이터 흐름, 주식, 센서 데이터, 로그 등 실시간으로 발생하여 연속적으로 들어오는 데이터
     - 스트림 처리: 실시간으로 들어오는 데이터를 연속적으로 처리하는 방식
     - 스트림 처리 어플리케이션
       - 이벤트(게시글 생성/수정/삭제, 댓글 생성/삭제, 좋아요 생성/삭제, 조회수 증가)를 실시간으로 받아서 처리
       - 실시간으로 인기글에 필요한 점수를 계산하여 상위 10건을 미리 생성 가능

- 인기글 설계
  1. 인기글 선정에 필요한 이벤트를 스트림을 수신
  2. 실시간으로 각 게시글 점수 계산
  3. 실시간으로 상위 10건의 인기글 목록 생성
  4. Client는 인기글 목록을 조회
  - 스트림 소스
    - 게시글, 댓글, 좋아요, 조회수 이벤트
    - 조회수는 트래픽이 많을 것으로 예상하여, 백업 단위(100개)로 수신, 조회수까지 정확하게 계산할 필요는 없다는 관점
  - 인기글 데이터(계산 결과)
    - 인기글은 7일간만 내역 관리 필요 -> 휘발성
    - Redis 사용
      - In-memory DB로 빠른 조회 가능
      - Sorted Set 자료구조 사용
        - 점수를 기준으로 정렬된 상태로 데이터 저장
        - 점수 기반 순위 조회에 적합: 상위 10건 게시글을 정렬상태로 유지 가능
      - 휘발성 데이터 저장 가능: TTL 설정 가능
  - 이벤트 전달
    - 전달방식 종류
      - API
        - 데이터 변경 발생 시 API 호출하여 이벤트 전달
        - 장점: 구현이 간단
        - 단점: 타 서비스 직접적 의존 -> 결합도 증가, 장애 전, 유실 위험
      - Message Broker(채택)
        - 데이터 변경 발생 시 Message Broker에 이벤트 전달 후 인기글 서비스에서 이벤트를 가져와 처리
        - Kafka, RabbitMQ 등
        - 장점: 타 서비스와 간접적 의존 -> 결합도 감소, 장애 전 유실 위험 감소, 확장성 용이
        - 단점: Message Broker 구축 및 관리 필요